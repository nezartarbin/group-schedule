<!DOCTYPE html>
<html>
    <head>
        <title>Schedule App</title> 
        <!--Importing Google Font-->
        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <!--Importing local CSS stylesheet-->
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <!--importing Axios JS for HTTP requests-->
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script>
            // creating a function that will make post Requests to our API
            function poststuff() {

                //Select all active (clicked) schedule time slots using the "schedule-cell-clicked" class
                //We assigned this class to all clicked time slots (div) in the body section

                var clickedDivs = document.querySelectorAll(".schedule-cell-clicked");

                /*querySelectorAll returns an array. But each unit in the array does not
                give is useful information. We need to extract useful data from it. In Body,
                we saved useful information in a property called "timeValue". We need to make
                an array of this useful information*/

                //first, we create an empty array
                var availability = new Array;

                /* we iterate through the array of divs we selected earlier. From each
                one, we extract the data we need (timeValue) and add it (push) to the empty
                array named "availability"*/
                clickedDivs.forEach((clickedDiv) => {
                    availability.push(clickedDiv.timeValue);
                })

                //We make a post request using axios. "availability" will be our request body
                axios.post('/user', availability)
                .then((res) => {
                    console.log(response);
                }).catch((err) => {
                    console.log(err);
                })
            }
         </script>
    </head>

    <body>
        <h1> Group Schedule </h1>
        <!--schedule-div is a grid container, or wrapper-->
        <div id="schedule-div">
            <!--We need to create a grid (table) of time slots.
            we could make every div individually, but this is not
            a good idea. Too many divs. we use Javascript.-->

            <!--Our grid needs to consist of one row with every day
            of the week in it, and then 24 rows of each hour of the day.
            Each slot needs to have the hour of the day written on it.-->

            <script>
                /* var hour will store a placeholder for the hour number
                which will be written on each div. When we move down a row,
                "hour" needs to change accordingly */
                var hour = 11

                //an Array of weekdays. We will use it later.
                var weekDay = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

                /* We make our divs here. With one for loop, we will make all.
                7 columns (for each day of the weak), 25 rows (1 for days and
                24 for each hour) totalling 175 divs.*/
                for (i=0; i < 175; i++) {
                    //We create the div element. We did not write it in the document yet.
                    var childDiv = document.createElement("div");

                    /*By default, a time slot should have a click state of false.
                    What's a clickstate? it is a property that will store information
                    on whether the slot has been clicked (is active) or not. If it has
                    not been clicked yet, it should be false, because user has not 
                    selected it yet */
                    childDiv.clickstate = false;

                    //Each hour is either AM or PM
                    /*each hour will be written 7 times before being clicked
                    every 7 i's, hour increases by one. If it ever surpasses 12,
                    then we crossed AM and started PM; afternoon*/
                    if (i/7 < 13) {
                        halfDay = "AM";
                    }
                    else {
                        halfDay = "PM";
                    };

                    //first 7 divs reserved for day of the week labels; first row.
                    if(i < 7) {
                        childDiv.className = "schedule-day";
                        childDiv.textContent = weekDay[i];
                    }

                    //Remaining divs are time slots
                    else {
                        //Every time i has increased 7 times, we increase hour by 1
                        if ((i%7) == 0) {hour++};
                        //assign correct unclicked (neutral) class to the time slot
                        childDiv.className = "schedule-cell";
                        //we fill the slot with its hour. if it is 3, it'll say 3:00 PM
                        childDiv.textContent = hour + ":00 " + halfDay;
                        //store useful information in timeValue property
                        //this info will be sent to our API using a post request
                        childDiv.timeValue = {
                            "hour": hour,
                            "mid": halfDay,
                            "day": weekDay[i%7]
                        };
                        //Once "hour" reaches 12 and completes a full row, it is reset to 0
                        //This is only if we don't want a 24-hour system instead of AM/PM
                        if (hour > 11 && (i%7) == 6) {hour = 0};
                    }
                    //Now that we have our div, we write in the document
                    //We select the wrapper div we want to put it in, and insert (appendChild).
                    document.querySelector("#schedule-div").appendChild(childDiv);
                }

                //with all our created divs ready, we select all of them and store them in "cells"
                var cells = document.querySelectorAll(".schedule-cell");

                /* we need to add an "onclick" event. It will change the color of the slot
                when clicked, and remember that it was clicked by storing it in clickstate.
                remember we set it to "false" by default*/

                //"cells" is an array. To add "onclick", we need to access each item individually
                //we iterate through it using forEach.
                cells.forEach((div) => {
                    div.onclick = () => {
                        //whatever "clickstate" is, we make it the opposite.
                        //if it's true, it becomes false. vice versa.
                        div.clickstate = !div.clickstate;

                        //if it has been clicked, we assign it "schedule-cell-clicked class"
                        if (div.clickstate) {div.className = "schedule-cell-clicked"}
                        //if it is not clicked, or clicked again, it is assigned the default "schedule-cell" class.
                        else {div.className = "schedule-cell"};
                    };
                });
                //delete dummy variables to clear memory.
                delete hour;
                delete weekDay;
            </script>
        </div>
        <!--submit button. When clicked, it will call function "poststuff() which is defined in head-->
        <button id="submit-time" onclick="poststuff()">Submit</button>
    </body>
</html>